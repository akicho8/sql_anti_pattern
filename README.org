* SQLアンチパターン覚え書き

   | 名前                   | 概要                                         |
   |------------------------+----------------------------------------------|
   | 信号無視               | 1つのカラムにIDを複数格納                    |
   | 複数列属性             | 面倒なのでカラムを連番で増やしていく         |
   | 闇雲インデックス       | とりあえず、すべてにインデックスを張っとこう |
   | 幻のファイル           | カラムに画像ファイルのパスを格納             |
   | 読み取り可能パスワード | パスワードをそのまま格納                     |

** [[jaywalking.rb][信号無視]]

# #+INCLUDE: "jaywalking.rb" ruby
# #+INCLUDE: "https://raw.githubusercontent.com/akicho8/sql_anti_pattern/master/jaywalking.rb" ruby
# #+INCLUDE: "jaywalking.rb" example

#+BEGIN_SRC ruby
ActiveRecord::Schema.define do
  create_table :users do |t|
    t.string :friends_ids
  end
end

class User < ActiveRecord::Base
  def friends
    User.find(friends_ids.scan(/\d+/))
  end
end

user = User.create!
user.friends_ids = 2.times.collect { User.create!.id }.join(",")
user.friends_ids # => "2,3"
user.friends     # => [#<User id: 2, friends_ids: nil>, #<User id: 3, friends_ids: nil>]
#+END_SRC

** [[multi_column_attribute.rb][複数列属性]]

#+BEGIN_SRC ruby
create_table :users do |t|
  t.string :profile_image1
  t.string :profile_image2
  t.string :profile_image3
end
#+END_SRC

** [[index_shotgun.rb][闇雲インデックス]]

#+BEGIN_SRC ruby
create_table :articles do |t|
  t.string :title
  t.string :message
  t.timestamps

  t.index :id
  t.index :title
  t.index :message
  t.index :created_at
  t.index :updated_at
  t.index [:title, :message]
  t.index [:id, :title, :message, :created_at, :updated_at], :unique => true, :name => :all
end
#+END_SRC

** [[phantom_files.rb][幻のファイル]]

#+BEGIN_SRC ruby
ActiveRecord::Schema.define do
  create_table :users do |t|
    t.string :profile_image_path
  end
end

user = User.create!(:profile_image_path => "path/to/profile.png") # => #<User id: 1, profile_image_path: "path/to/profile.png">
#+END_SRC

** [[readable_passwords.rb][読み取り可能パスワード]]

#+BEGIN_SRC ruby
user = User.create!(:password => "password")
user.password_before_type_cast  # => "password"
#+END_SRC
